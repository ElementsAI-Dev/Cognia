# Implementation Plan: A2UI Integration

**Branch**: `master` | **Date**: 2026-01-03 | **Spec**: `/specs/master/spec.md`

## Summary

Integrate Google's A2UI protocol to enable AI-generated interactive user interfaces in the Cognia chat application. The implementation maps A2UI's declarative JSON components to existing shadcn/ui React components, enabling rich UI generation from AI responses and agent tool outputs.

## Technical Context

**Language/Version**: TypeScript 5.x, React 19.2  
**Primary Dependencies**: Next.js 16, shadcn/ui, Tailwind CSS v4, Zustand  
**Storage**: IndexedDB (Dexie) for A2UI state persistence  
**Testing**: Jest + React Testing Library, Playwright E2E  
**Target Platform**: Web (desktop/mobile browsers), Tauri desktop  
**Project Type**: Web application (Next.js App Router)  
**Performance Goals**: 60fps UI updates, <100ms render latency  
**Constraints**: Must integrate with existing message rendering pipeline  
**Scale/Scope**: Support for 20+ A2UI component types

## Project Structure

### Documentation (this feature)

```text
specs/master/
├── spec.md              # Feature specification
├── plan.md              # This file
└── tasks.md             # Task list (generated by /speckit.tasks)
```

### Source Code (repository root)

```text
# A2UI Integration Structure
lib/
├── a2ui/                    # A2UI protocol implementation
│   ├── index.ts             # Main exports
│   ├── types.ts             # A2UI type definitions
│   ├── parser.ts            # JSON message parser
│   ├── data-model.ts        # Data model with JSON Pointer resolution
│   ├── catalog.ts           # Component catalog registry
│   └── events.ts            # User action event handling

components/
├── a2ui/                    # A2UI React components
│   ├── index.ts             # Component exports
│   ├── a2ui-surface.tsx     # Surface container
│   ├── a2ui-renderer.tsx    # Component tree renderer
│   ├── a2ui-context.tsx     # React context for data model
│   └── components/          # Individual component mappings
│       ├── a2ui-text.tsx
│       ├── a2ui-button.tsx
│       ├── a2ui-textfield.tsx
│       ├── a2ui-select.tsx
│       ├── a2ui-card.tsx
│       ├── a2ui-row.tsx
│       ├── a2ui-column.tsx
│       ├── a2ui-list.tsx
│       ├── a2ui-image.tsx
│       ├── a2ui-chart.tsx
│       ├── a2ui-table.tsx
│       ├── a2ui-checkbox.tsx
│       ├── a2ui-radio.tsx
│       ├── a2ui-slider.tsx
│       ├── a2ui-datepicker.tsx
│       ├── a2ui-dialog.tsx
│       └── a2ui-fallback.tsx

stores/
├── a2ui-store.ts            # Zustand store for A2UI state

types/
├── a2ui.ts                  # TypeScript type definitions

hooks/
├── use-a2ui.ts              # A2UI integration hook
├── use-a2ui-data-model.ts   # Data model hook with binding

# Integration Points (existing files to modify)
components/chat/
├── chat-container.tsx       # Add A2UI message detection
├── message-parts/
│   └── a2ui-part.tsx        # New: A2UI message part renderer

components/agent/
├── tool-timeline.tsx        # Add A2UI tool output rendering
```

## Key Design Decisions

### 1. Component Mapping Strategy

A2UI standard components map to shadcn/ui:

| A2UI Component | shadcn/ui Equivalent |
|----------------|---------------------|
| Text | `<p>`, Typography |
| Button | `<Button>` |
| TextField | `<Input>` |
| Select | `<Select>` |
| Card | `<Card>` |
| Row | `<div className="flex">` |
| Column | `<div className="flex flex-col">` |
| List | Dynamic via template |
| Image | `<img>` with aspect ratio |
| Table | `<Table>` |
| Checkbox | `<Checkbox>` |
| Radio | `<RadioGroup>` |
| Slider | `<Slider>` |
| DatePicker | `<Calendar>` + `<Popover>` |
| Dialog | `<Dialog>` |

### 2. Data Binding Implementation

Use JSON Pointer (RFC 6901) for path resolution:
- Absolute paths: `/user/name` → `dataModel.user.name`
- Relative paths in templates: `name` → current item's `name`
- Two-way binding via Zustand store updates

### 3. Message Detection

A2UI content detected in AI responses by:
1. Explicit `a2ui` message part type
2. JSON with `surfaceId` and `components` fields
3. Tool outputs with A2UI metadata

### 4. Streaming Support

Buffer A2UI messages during streaming:
1. Detect `createSurface` message → initialize surface
2. Buffer `updateComponents` until batch complete
3. Apply `dataModelUpdate` reactively
4. Render on `surfaceReady` or batch timeout

## Dependencies

### New Packages (if needed)

```json
{
  "json-pointer": "^0.6.2"  // RFC 6901 implementation
}
```

### Existing Dependencies Leveraged

- shadcn/ui components (Button, Input, Select, Card, Dialog, etc.)
- Zustand for state management
- Recharts for chart rendering (already in use)
- Tailwind CSS for layout (Row, Column)

## Risk Assessment

| Risk | Mitigation |
|------|------------|
| A2UI spec still evolving (v0.9 draft) | Implement core stable features, abstract version-specific logic |
| Performance with complex surfaces | Virtual list for large lists, memoization, batch updates |
| Unknown component fallback UX | Clear fallback component with warning, log for debugging |
| Streaming partial state | Buffer mechanism with timeout, show loading state |
